<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="search" type="application/opensearchdescription+xml" title="ModDota" href="/opensearch.xml"><title data-react-helmet="true">Lua Item Tutorial | ModDota</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Lua Item Tutorial | ModDota"><meta data-react-helmet="true" name="description" content="This tutorial is walk-through of creating completely new item with the new item_lua base class."><meta data-react-helmet="true" property="og:description" content="This tutorial is walk-through of creating completely new item with the new item_lua base class."><meta data-react-helmet="true" property="og:url" content="https://moddota.com/abilities/lua-item-tutorial"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://moddota.com/abilities/lua-item-tutorial"><link rel="stylesheet" href="/styles.feceb74b.css">
<link rel="stylesheet" href="/main.8db07b0a.css">
<link rel="preload" href="/styles.3ddff82c.js" as="script">
<link rel="preload" href="/runtime~main.664ba720.js" as="script">
<link rel="preload" href="/main.cd2666c9.js" as="script">
<link rel="preload" href="/1.121d2a65.js" as="script">
<link rel="preload" href="/2.37db2c14.js" as="script">
<link rel="preload" href="/1be78505.25cc5caf.js" as="script">
<link rel="preload" href="/ec1ed54d.b1d23cdd.js" as="script">
<link rel="preload" href="/59ffb1e8.dacc4226.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo-80x80.png"><strong class="navbar__title">ModDota</strong></a><a class="navbar__item navbar__link" href="/tutorials">Tutorials</a><a href="https://dota.tools/vscripts/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Lua API</a><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama/Javascript/API" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Panorama API</a></div><div class="navbar__items navbar__items--right"><a href="https://discord.gg/gRmZgvz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/images/logo-80x80.png"><strong class="navbar__title">ModDota</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tutorials">Tutorials</a></li><li class="menu__list-item"><a href="https://dota.tools/vscripts/" target="_blank" rel="noopener noreferrer" class="menu__link">Lua API</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama/Javascript/API" target="_blank" rel="noopener noreferrer" class="menu__link">Panorama API</a></li><li class="menu__list-item"><a href="https://discord.gg/gRmZgvz" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1jis"><div class="docSidebarContainer_1kjN"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/scripting-introduction">Scripting Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Typescript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/Typescript/typescript-introduction">Typescript Introduction</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Abilities, items, modifiers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/ability-keyvalues">Ability KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/item-keyvalues">Item KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/the-importance-of-abilityspecial-values">The importance of AbilitySpecial values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/passing-abilityspecial-values-into-lua">Passing AbilitySpecial values into Lua</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/abilityduration-tooltips">AbilityDuration tooltips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/simple-custom-ability">Simple Custom Ability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/creating-innate-abilities">Creating innate (available from level 1) abilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/making-any-ability-use-charges">Making any ability use charges</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/calling-spells-with-setcursor">Calling Spells with SetCursor</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers" tabindex="0">Lua Abilities and Modifiers</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/abilities/lua-item-tutorial">Lua Item Tutorial</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Lua Modifiers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/1">Extending Hero/NPC API with lua modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/2">Linken&#x27;s Sphere &amp; Lotus Orb</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/3">Transformations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/lua-modifiers/4">Enchanting Trees</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/abilities/reutilizing-built-in-modifiers">Reutilizing Built-In Modifiers</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Datadriven</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/datadriven-ability-events-modifiers">DataDriven Ability Events &amp; Modifiers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/all-about-the-target">All about the Target</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/channeling-animations">Channeling Animations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/invisibility-ability-example">Invisibility Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/illusion-ability-example">Illusion Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/rotate-ability-example">Rotate Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/point-channeling-aoe-ability-example">Point Channeling AoE Ability Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/apply-hero-and-creep-modifier-durations">Apply Hero and Creep modifier durations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/abilities/datadriven/physics-ability-example-exorcism">Physics Ability Example - Exorcism</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Units</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/unit-keyvalues">Unit KeyValues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/unit-producing-buildings">Unit producing buildings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/creating-units-with-a-duration">Creating units with a duration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/adding-a-very-simple-ai-to-units">Adding a Very Simple AI to Units</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/simple-neutral-ai">Writing a simple AI for neutrals</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/units/create-creature-attachwearable-blocks-directly-from-the-keyvalues">Create Creature AttachWearable blocks directly from the keyvalues</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Scripting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/custom-mana-system">Custom Mana System</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/item-restrictions-requirements">Item Restrictions &amp; Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/item-drop-system">Item Drop System</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/making-a-rpg-like-looting-chest">Making a &quot;rpg-like&quot; looting chest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/scripted-shop-spawning">Scripted Shop Spawning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/lava-damage">Lava damage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/using-dota-filters">Using the order filter and other filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/particle-attachment">Particle Attachment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/vector-math">Basic Vector Math</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/scripting/precache-fixing-and-avoiding-issues">Precache, Fixing and avoiding issues</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Nettables" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Nettables" tabindex="-1">Custom NetTables</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Panorama UI</a><ul class="menu__list"><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Panorama" tabindex="-1">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/inclusive-panorama-ui">Inclusive Panorama UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/introduction-to-panorama-ui-with-typescript">Introduction to Panorama UI with TypeScript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/keybindings">Keybindings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/dotascenepanel">DOTAScenePanel</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/button-examples">Button Examples</a></li><li class="menu__list-item"><a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Game_Setup" target="_blank" rel="noreferrer noopener" class="menu__link" to="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Custom_Game_Setup" tabindex="-1">Custom Game Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/hiding-hud-with-sethudvisible">Hiding HUD with SetHUDVisible</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/webpack">Bundling scripts with webpack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/panorama/react">React in Panorama</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Assets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/asset-file-type-reference">Asset File Type Reference</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Maps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/maps/hammer-tutorials">Hammer Tutorials</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/maps/making-skip-clip-blocks-out-of-models">Making skip/clip blocks out of models</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Models</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/importing-custom-models">Importing custom models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/mdl-to-vmdl-conversion">MDL to VMDL Conversion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/adding-hitbox-to-models-without-a-bone">Adding Hitbox to Models without a Bone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/importing-models-and-using-material-editor">Importing models and using the material editor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/exporting-models-and-materials-textures">Exporting Models and Materials/Textures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/models/custom-hero-models-materials-animations">Custom Hero models, materials and animations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Particles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/particle-basics">Particle Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/chaos-wave-particle">Chaos Wave Particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/falling-cherry-blossom-petal-for-spring-mood-particle">Falling cherry blossom petal for spring mood particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/volcano-particle">Volcano Particle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/particles/status-effects">Status Effects</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/custom-sounds">Custom Sounds</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/extracting-and-compiling-vtex-files">Extracting and Compiling VTEX files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/assets/custom-minimap-icons">Custom Minimap Icons</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/useful-console-commands">Useful Console Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/setting-up-your-addon-with-github">Setting Up Your Addon With GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tools/combining-kv-files-using-base">Combining KV files using #base</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/contribute">Contribute</a></li></ul></div></div></div><main class="docMainContainer_3j_A"><div class="container padding-vert--lg docItemWrapper_1Hme"><div class="row"><div class="col docItemCol_2AGf"><div class="docItemContainer_1tAC"><article><div style="margin-top:-10px;margin-bottom:10px"><div class="row"><div class="col"><a href="https://github.com/ModDota/moddota.github.io/edit/source/_articles/abilities/lua-item-tutorial.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Created on <time datetime="2015-08-07T00:00:00.000Z" class="docLastUpdatedAt_1gIo">8/7/2015</time> by <strong><a href="https://steamcommunity.com/profiles/76561197975484185">DrTeaSpoon</a></strong></small></em></div></div></div><header><h1 class="docTitle_cWlf">Lua Item Tutorial</h1></header><div class="markdown"><p>This tutorial is walk-through of creating completely new item with the new item_lua base class. <br>
For this first tutorial we create upgrade from Blink Dagger to Blink Staff. How it will work is that when targeting any point in ground it will work like Blink Dagger does but if you target allied Unit you can &#x27;tag&#x27; it to blink instead of you. We will also add passive bonuses from the item we will have in the recipe.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="blink-staff"></a>Blink Staff<a aria-hidden="true" tabindex="-1" class="hash-link" href="#blink-staff" title="Direct link to heading">#</a></h3><p>First open up your npc_items_custom.txt in your favourite text editor. (I use notepad++) If  you don&#x27;t have this file in your scripts\npc\ folder then create it and copy following into it.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&quot;DOTAAbilities&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div><p>First and most important thing is naming your item. for this example I will use &quot;item_blink_staff&quot;. Note that using the same name when referring to this item is important as dota 2 assumes some naming schemes.<br>
We will also setup unique ID for the item and a base class that tells the game that we are intending to create a lua item.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&quot;DOTAAbilities&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1250&quot; // anything above 1250 should be safe to use.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div><p>Next we need an image for the item. For that we use &quot;AbilityTextureName&quot; as items classify as sort of abilities in dota 2. Its important that we have our image file in correct place and named correctly. <br>For item in this example the file should be found from following path:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"> dota 2 beta\game\dota_addons\{your addon name}\resource\flash3\images\items\blink_staff.png</span></div></div></div></div></div><p>note that the file name is &#x27;blink_staff.png&#x27; instead of &#x27;item_blink_staff.png&#x27;. This is because dota will read ability texture name of &#x27;item_blink_staff&#x27; as &#x27;item\blink_staff.png&#x27;<br>It is also important to note that using same name for your ability texture is doubly important as the image in shop doesn&#x27;t appear correctly if you use different name.<br>
The image I will be using for this item is this one: <img src="https://i.imgur.com/yz4ghPc.png" alt="enter image description here" title="blink_staff.png"><br></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&quot;DOTAAbilities&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1250&quot; // anything above 1250 should be safe to use.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityTextureName&quot;            &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div><p>The last part we must add is link to the script file. You should create new *.lua file somewhere in your scripts\vscripts folder. You can even create sub-folder for it if you want to be organized. Now your &#x27;npc_items_custom.txt&#x27; should be something like this.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&quot;DOTAAbilities&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1250&quot; // anything above 1250 should be safe to use.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityTextureName&quot;            &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ScriptFile&quot;                    &quot;lua_items/blink_staff/blink_staff.lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div><p>Truth of the lua items and abilities is that all you really need to define for them in lua file is their class table. So lets create that into our lua file:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if item_blink_staff == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    item_blink_staff = class({})</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>IMPORTANT: Make sure you use same name as you defined in your npc_items_custom.txt<br>
Now next we want to define cooldown and mana cost for our blink staff. This can be done through &#x27;npc_items_custom.txt&#x27; or through lua. Note that everything we define through lua we can manipulate more dynamically. For example we could reduce cooldown by half durring night time or double the mana cost if player has positive k/d ratio.<br>
Also advantage of defining them in npc_items_custom.txt is that what ever shows in the store (before player has the item) is the values defined there. Also currently there is issue that Manacost will always display the value defined by &#x27;npc_item_custom.txt&#x27; but the item will still grey(blue?)-out when your mana is lower than what is defined in lua for mana cost.<br>
Because we want things to look smooth lets define some basic parameters we can later over ride in lua as we like:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">&quot;DOTAAbilities&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1250&quot; // anything above 1250 should be safe to use.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityTextureName&quot;            &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ScriptFile&quot;                    &quot;lua_items/blink_staff/blink_staff.lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Casting</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //--------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityCastRange&quot;              &quot;0&quot; //We could define limit here but blink dagger has unlimited range to let player use it more efficiently. The range limiting comes in the script. 0 means unlimited.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityCastPoint&quot;              &quot;0.3&quot; //It&#x27;s the wind up time of spell.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityCooldown&quot;               &quot;10.0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityManaCost&quot;               &quot;50&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div><p>For more key-value stuff involving items use Noyas guide: <a href="http://moddota.com/forums/discussion/4/datadriven-items" target="_blank" rel="noopener noreferrer">http://moddota.com/forums/discussion/4/datadriven-items</a></p><br> Its great reference but lets get on with the lua stuff!<h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="defining-cast-rules"></a>Defining Cast Rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#defining-cast-rules" title="Direct link to heading">#</a></h3><p>First we add behaviours. This will define what happens when player activates the hot-key of the item.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetBehavior() </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local behav = DOTA_ABILITY_BEHAVIOR_POINT + DOTA_ABILITY_BEHAVIOR_UNIT_TARGET + DOTA_ABILITY_BEHAVIOR_ROOT_DISABLES</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return behav</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>The GetBehaviour() function is called by the engine when it needs to know how the ability should act on different occations. The &#x27;return&#x27; should return number &#x27;int&#x27; value. Valve has made defining this easy for us by providing them as keys we can just sum together. These values take advantage of bit band where for example:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Key ------ Value ------ Bytes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DOTA_ABILITY_BEHAVIOR_UNIT_TARGET ------ 8 ------ 01000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DOTA_ABILITY_BEHAVIOR_POINT ------ 16 ------ 10000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DOTA_ABILITY_BEHAVIOR_UNIT_TARGET + DOTA_ABILITY_BEHAVIOR_POINT ------ 24 ------ 11000</span></div></div></div></div></div><p>As you can see in the bytes, while the value might look arbitrary, the bytes act like on/off switch of the behaviour.
For available values for the behaviours use following link: <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/API#DOTA_ABILITY_BEHAVIOR" target="_blank" rel="noopener noreferrer">https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/API#DOTA_ABILITY_BEHAVIOR</a></p><p>Next we add mana cost and cooldown.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetManaCost()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return 50</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCooldown( nLevel )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return 10</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>As items are defined like abilities the GetCooldown function has helper parameter for level of the ability. You can ignore it for items completely as the level will almost always be 1 (exception  of corner cases like bkb or dagon.)</p><p>Now lets get to the actual spell casting part.</p><p>First we create OnSpellStart() function and define some initial keys to use in the script.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:OnSpellStart()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hTarget = false --We might not have target so we make fail-safe so we do not get an error when calling - self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if not self:GetCursorTargetingNothing() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hTarget = self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = self:GetCursorPosition() --We will always have Vector for the point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxBlink = 1200 --How far can we actually blink?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nClamp = 960 --If we try to over reach we use this value instead. (this is mechanic from blink dagger.)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Note that while we are in &#x27;item_blink_staff&#x27; class we can use &#x27;self&#x27; as quick reference to it.<br>
Now that we have our stuff set up lets start blinking our caster!</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:OnSpellStart()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hTarget = false --We might not have target so we make fail-safe so we do not get an error when calling - self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if not self:GetCursorTargetingNothing() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hTarget = self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = self:GetCursorPosition() --We will always have Vector for the point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxBlink = 1200 --How far can we actually blink?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nClamp = 960 --If we try to over reach we use this value instead. (this is mechanic from blink dagger.)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ProjectileManager:ProjectileDodge(hCaster)  --We disjoint disjointable incoming projectiles.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ParticleManager:CreateParticle(&quot;particles/items_fx/blink_dagger_start.vpcf&quot;, PATTACH_ABSORIGIN, hCaster) --Create particle effect at our caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    hCaster:EmitSound(&quot;DOTA_Item.BlinkDagger.Activate&quot;) --Emit sound for the blink</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxBlink then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        vPoint = vOrigin + (vPoint - vOrigin):Normalized() * nClamp -- Recalculation of the target point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    hCaster:SetAbsOrigin(vPoint) --We move the caster instantly to the location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    FindClearSpaceForUnit(hCaster, vPoint, false) --This makes sure our caster does not get stuck</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ParticleManager:CreateParticle(&quot;particles/items_fx/blink_dagger_end.vpcf&quot;, PATTACH_ABSORIGIN, hCaster) --Create particle effect at our caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>IMPORTANT: We are using sounds and particle effects already precached by default. If you wish to use particle effects and sounds from other heroes or your custom ones then you have to do precaching for those resources.<br>
This is what our item should do right now:</p><p style="position:relative;padding-bottom:75%"><iframe src="https://gfycat.com/ifr/RepentantYellowishDiscus" scrolling="no" frameborder="0" allowfullscreen="" width="100%" height="100%" style="position:absolute;top:0;left:0"></iframe></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="cast-on-allied"></a>Cast on Allied<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cast-on-allied" title="Direct link to heading">#</a></h3><p>Now we are going to create the part that makes this item unique compared to blink dagger. First we if statement in our cast function that distinguishes how it should act depending on the target. Also at same time we make sure that double tapping the item works like it does with blink dagger (self targeting blinks towards base)</p><p>Because this lua ability stuff still has some minor issues we have to return to our &#x27;npc_items_custom.txt&#x27; file to add some targeting help. Just add the following to the item.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityUnitTargetTeam&quot;         &quot;DOTA_UNIT_TARGET_TEAM_FRIENDLY&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityUnitTargetType&quot;         &quot;DOTA_UNIT_TARGET_HERO | DOTA_UNIT_TARGET_BASIC&quot;</span></div></div></div></div></div><p>Now looking at our lua code you can see that we can use most of our writen blink code in multiple places. Thats why we are going to change things around a bit like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:OnSpellStart()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hTarget = false --We might not have target so we make fail-safe so we do not get an error when calling - self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if not self:GetCursorTargetingNothing() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hTarget = self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = self:GetCursorPosition() --We will always have Vector for the point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxBlink = 1200 --How far can we actually blink?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nClamp = 960 --If we try to over reach we use this value instead. (this is mechanic from blink dagger.)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    self:Blink(hCaster, vPoint, nMaxBlink, nClamp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:Blink(hTarget, vPoint, nMaxBlink, nClamp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hTarget:GetAbsOrigin() --Our units&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ProjectileManager:ProjectileDodge(hTarget)  --We disjoint disjointable incoming projectiles.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ParticleManager:CreateParticle(&quot;particles/items_fx/blink_dagger_start.vpcf&quot;, PATTACH_ABSORIGIN, hTarget) --Create particle effect at our caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    hTarget:EmitSound(&quot;DOTA_Item.BlinkDagger.Activate&quot;) --Emit sound for the blink</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxBlink then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        vPoint = vOrigin + (vPoint - vOrigin):Normalized() * nClamp -- Recalculation of the target point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    hTarget:SetAbsOrigin(vPoint) --We move the caster instantly to the location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    FindClearSpaceForUnit(hTarget, vPoint, false) --This makes sure our caster does not get stuck</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ParticleManager:CreateParticle(&quot;particles/items_fx/blink_dagger_end.vpcf&quot;, PATTACH_ABSORIGIN, hTarget) --Create particle effect at our caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now we can just use the newly defined Blink function to blink our caster, and allies without writing it all again.<br>
Lets write the self cast now. We create IF statement first to check if we have hTarget. Then we check if the target is same as the caster or not. Also if we don&#x27;t have hTarget we default to blinking ourselves. To get the location we want to blink towards we need to find some target location. For this we will use the fountain. (ent_dota_fountain)</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:OnSpellStart()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hTarget = false --We might not have target so we make fail-safe so we do not get an error when calling - self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if not self:GetCursorTargetingNothing() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hTarget = self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = self:GetCursorPosition() --We will always have Vector for the point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxBlink = 1200 --How far can we actually blink?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nClamp = 960 --If we try to over reach we use this value instead. (this is mechanic from blink dagger.)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hTarget then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if hCaster == hTarget then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if not self.hFountain and not self.bNoFountain then --We check if we have ever tried finding the fountain before.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local hFountain = Entities:FindByClassname(nil, &quot;ent_dota_fountain&quot;) --Find first fountain</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local bFound = false --Make the boolean for while statement.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                while not bFound do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    if hFountain then --Is there a fountain entity?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        if hFountain:GetTeamNumber() == hCaster:GetTeamNumber() then -- Is it the right team?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            self.hFountain = hFountain --Store it so we don&#x27;t have to trouble finding the foundtain again.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            bFound = true --Make sure while statement ends</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            hFountain = Entities:FindByClassname(hFountain, &quot;ent_dota_fountain&quot;) --Find the next fountain if we didn&#x27;t find the right team.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        self.bNoFountain = true --We have concluded that there is no fountain entity for this team. Lets not do that again!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        bFound = true --We could alternatively use &#x27;Break&#x27; but I find this more funny.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if self.hFountain then --Do we have fountain?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                vPoint = self.hFountain:GetAbsOrigin() --Lets change our target location there then.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:EndCooldown() </span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:RefundManaCost() </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>As you can see, this time we used while statement to go through all fountain entities and stored the results of our search into the ability. If it finds no entities it saves a boolean value so that it won&#x27;t try to find fountain the next time. Also just like blink dagger if the target cannot be found the we won&#x27;t blink at all.</p><br>Next we need to allow targeting allies with the spell but instead of blinking we store their id for next time we do &quot;point&quot; targeting on ground. There are few ways we can do this but It would be fair if we give them some sort of warning what is happening. So lets create two modifiers. One will simply be effect on target ally and one will be hidden modifier to store the target&#x27;s entity index for short duration.<p>First we need to link our intended modifiers to the ability. Top of your blink staff lua file should look like this</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if item_blink_staff == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    item_blink_staff = class({})</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">LinkLuaModifier( &quot;item_blink_staff_effect_modifier&quot;, &quot;lua_items/blink_staff/effect_modifier.lua&quot;, LUA_MODIFIER_MOTION_NONE )</span></div></div></div></div></div><p>Then we need our effect modifier file that was declared. For purposes of this tutorial we will use particle effect for armlet so we can skip precache again.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if item_blink_staff_effect_modifier == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    item_blink_staff_effect_modifier = class({})</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_effect_modifier:OnCreated( kv )   </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if IsServer() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if self:GetCaster() ~= self:GetParent() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local nFXIndex = ParticleManager:CreateParticle(&quot;particles/items_fx/armlet.vpcf&quot;, PATTACH_ROOTBONE_FOLLOW, self:GetParent())</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:AddParticle( nFXIndex, false, false, -1, false, false )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_effect_modifier:GetAttributes() </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return MODIFIER_ATTRIBUTE_MULTIPLE + MODIFIER_ATTRIBUTE_IGNORE_INVULNERABLE</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_effect_modifier:IsHidden()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if self:GetCaster() == self:GetParent() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return true</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return false</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>As you can see we for the first time used IsServer() function. This is used so some of the game logic is not ran multiple times (as some portions of the code is ran on both clients and server)
Also for purposes of this tutorial we will use this same effect for both the caster and the target of the blink staff. We could create two modifiers but that would be wasteful. That&#x27;s why we added some extra functionality to the modifier so we can distinguish if the target of the modifier is the caster or not. Also in case there are more than one blink staff in game we make sure there can be multiple modifiers of the same type on single unit.</p><p>Now we need to add the code that lets us add the modifier to the target and store that target&#x27;s entity index to our modifier and when point casting retrieve the target again. For this tutorial we give player five seconds to recast. We also end cooldown and refund mana cost on ally target.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:OnSpellStart()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hTarget = false --We might not have target so we make fail-safe so we do not get an error when calling - self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if not self:GetCursorTargetingNothing() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hTarget = self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = self:GetCursorPosition() --We will always have Vector for the point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxBlink = 1200 --How far can we actually blink?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nClamp = 960 --If we try to over reach we use this value instead. (this is mechanic from blink dagger.)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hTarget then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if hCaster == hTarget then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if not self.hFountain and not self.bNoFountain then --We check if we have ever tried finding the fountain before.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local hFountain = Entities:FindByClassname(nil, &quot;ent_dota_fountain&quot;) --Find first fountain</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local bFound = false --Make the boolean for while statement.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                while not bFound do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    if hFountain then --Is there a fountain entity?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        if hFountain:GetTeamNumber() == hCaster:GetTeamNumber() then -- Is it the right team?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            self.hFountain = hFountain --Store it so we don&#x27;t have to trouble finding the foundtain again.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            bFound = true --Make sure while statement ends</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            hFountain = Entities:FindByClassname(hFountain, &quot;ent_dota_fountain&quot;) --Find the next fountain if we didn&#x27;t find the right team.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        self.bNoFountain = true --We have concluded that there is no fountain entity for this team. Lets not do that again!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        bFound = true --We could alternatively use &#x27;Break&#x27; but I find this more funny.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if self.hFountain then --Do we have fountain?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                vPoint = self.hFountain:GetAbsOrigin() --Lets change our target location there then.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:EndCooldown() --Cooldown refund if we could not find fountain on self cast</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:RefundManaCost() --Manacost refund if we could not find fountain on self cast</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hTarget:AddNewModifier( hCaster, self, &quot;item_blink_staff_effect_modifier&quot;, { duration = 5 } ) --lets add modifier to target</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hCaster:AddNewModifier( hCaster, self, &quot;item_blink_staff_effect_modifier&quot;, { duration = 5 } ) --lets add modifier to caster</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local hModifier = hCaster:FindModifierByNameAndCaster(&quot;item_blink_staff_effect_modifier&quot;, hCaster) --find that modifier (they really should fix this by returning handle when adding new modifier.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local nTargetIndex = hTarget:GetEntityIndex() --lets find the targets entity index</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hModifier:SetStackCount(nTargetIndex) --add that index to the modifier as it&#x27;s stack count</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:EndCooldown() --Cooldown refund so can cast again</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:RefundManaCost() --Manacost refund</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local hModifier = hCaster:FindModifierByNameAndCaster(&quot;item_blink_staff_effect_modifier&quot;, hCaster) --Check if we have someone selected</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if hModifier then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hTarget = EntIndexToHScript(hModifier:GetStackCount()) --Find the target with the ent index</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if hTarget:FindModifierByNameAndCaster(&quot;item_blink_staff_effect_modifier&quot;, hCaster) then --Check if the target is not purged.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:Blink(hTarget, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else --Someone purged our target</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now there are two more things we need to do before we are done with our lua script. Right now this item has unlimited cast range for purposes of targeting allied unit. We also have issue of this item being abused when target does not want to be &#x27;helped&#x27; by another. (Aka. Disable Help)<br> Luckyly we have one tool for both of them: CastFilterResultTarget and GetCustomCastErrorTarget.<br>Lets add following functions to our item&#x27;s script:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:CastFilterResultTarget( hTarget ) -- hTarget is the targeted NPC.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = 1200 --How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_SUCCESS</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCustomCastErrorTarget( hTarget) -- hTarget is the targeted NPC. </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = 1200 --How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return &quot;#dota_hud_error_target_has_disable_help&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return &quot;#dota_hud_error_target_out_of_range&quot; --returning error from localization</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now to save time and sanity you might want to add &#x27;Special&#x27; values to your script. These are values you can modify easily without opening the script and searching for them there. This is extremely helpful when you use those values in multiple places. It also lets you display the values in your item description.<br>First add following block to your item in &#x27;npc_items_custom.txt&#x27;</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilitySpecial&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;01&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;max_blink&quot;             &quot;1200&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;02&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;blink_clamp&quot;           &quot;960&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;03&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;help_range&quot;            &quot;3000&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;04&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_FLOAT&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;help_duration&quot;         &quot;5.0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div></div></div></div></div><p>Now to use these values you use this function in your ability:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">self:GetSpecialValueFor( &quot;max_blink&quot; )</span></div></div></div></div></div><p>Or in your modifier you have to get the handle for your ability first:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">self:GetAbility():GetSpecialValueFor( &quot;max_blink&quot; )</span></div></div></div></div></div><p>Now we find and replace all those values with correct retrieval of a special value and we should end up with following result:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:OnSpellStart()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hTarget = false --We might not have target so we make fail-safe so we do not get an error when calling - self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if not self:GetCursorTargetingNothing() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hTarget = self:GetCursorTarget()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = self:GetCursorPosition() --We will always have Vector for the point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxBlink = self:GetSpecialValueFor( &quot;max_blink&quot; ) --How far can we actually blink?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nClamp = self:GetSpecialValueFor( &quot;blink_clamp&quot; ) --If we try to over reach we use this value instead. (this is mechanic from blink dagger.)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hTarget then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if hCaster == hTarget then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if not self.hFountain and not self.bNoFountain then --We check if we have ever tried finding the fountain before.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local hFountain = Entities:FindByClassname(nil, &quot;ent_dota_fountain&quot;) --Find first fountain</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local bFound = false --Make the boolean for while statement.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                while not bFound do</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    if hFountain then --Is there a fountain entity?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        if hFountain:GetTeamNumber() == hCaster:GetTeamNumber() then -- Is it the right team?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            self.hFountain = hFountain --Store it so we don&#x27;t have to trouble finding the foundtain again.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            bFound = true --Make sure while statement ends</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                            hFountain = Entities:FindByClassname(hFountain, &quot;ent_dota_fountain&quot;) --Find the next fountain if we didn&#x27;t find the right team.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        self.bNoFountain = true --We have concluded that there is no fountain entity for this team. Lets not do that again!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        bFound = true --We could alternatively use &#x27;Break&#x27; but I find this more funny.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if self.hFountain then --Do we have fountain?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                vPoint = self.hFountain:GetAbsOrigin() --Lets change our target location there then.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:EndCooldown() --Cooldown refund if we could not find fountain on self cast</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:RefundManaCost() --Manacost refund if we could not find fountain on self cast</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hTarget:AddNewModifier( hCaster, self, &quot;item_blink_staff_effect_modifier&quot;, { duration = self:GetSpecialValueFor( &quot;help_duration&quot; ) } ) --lets add modifier to target</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hCaster:AddNewModifier( hCaster, self, &quot;item_blink_staff_effect_modifier&quot;, { duration = self:GetSpecialValueFor( &quot;help_duration&quot; ) } ) --lets add modifier to caster</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local hModifier = hCaster:FindModifierByNameAndCaster(&quot;item_blink_staff_effect_modifier&quot;, hCaster) --find that modifier (they really should fix this by returning handle when adding new modifier.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            local nTargetIndex = hTarget:GetEntityIndex() --lets find the targets entity index</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hModifier:SetStackCount(nTargetIndex) --add that index to the modifier as it&#x27;s stack count</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:EndCooldown() --Cooldown refund so can cast again</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:RefundManaCost() --Manacost refund</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local hModifier = hCaster:FindModifierByNameAndCaster(&quot;item_blink_staff_effect_modifier&quot;, hCaster) --Check if we have someone selected</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if hModifier then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            hTarget = EntIndexToHScript(hModifier:GetStackCount()) --Find the target with the ent index</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if hTarget:FindModifierByNameAndCaster(&quot;item_blink_staff_effect_modifier&quot;, hCaster) then --Check if the target is not purged.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                self:Blink(hTarget, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else --Someone purged our target</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self:Blink(hCaster, vPoint, nMaxBlink, nClamp) --BLINK!</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:Blink(hTarget, vPoint, nMaxBlink, nClamp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hTarget:GetAbsOrigin() --Our units&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ProjectileManager:ProjectileDodge(hTarget)  --We disjoint disjointable incoming projectiles.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ParticleManager:CreateParticle(&quot;particles/items_fx/blink_dagger_start.vpcf&quot;, PATTACH_ABSORIGIN, hTarget) --Create particle effect at our caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    hTarget:EmitSound(&quot;DOTA_Item.BlinkDagger.Activate&quot;) --Emit sound for the blink</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxBlink then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        vPoint = vOrigin + (vPoint - vOrigin):Normalized() * nClamp -- Recalculation of the target point.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    hTarget:SetAbsOrigin(vPoint) --We move the caster instantly to the location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    FindClearSpaceForUnit(hTarget, vPoint, false) --This makes sure our caster does not get stuck</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    ParticleManager:CreateParticle(&quot;particles/items_fx/blink_dagger_end.vpcf&quot;, PATTACH_ABSORIGIN, hTarget) --Create particle effect at our caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:CastFilterResultTarget( hTarget ) -- hTarget is the targeted NPC.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) --How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_SUCCESS</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCustomCastErrorTarget( hTarget) -- hTarget is the targeted NPC. </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) --How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return &quot;#dota_hud_error_target_has_disable_help&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return &quot;#dota_hud_error_target_out_of_range&quot; --returning error from localization</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now if we want to make sure the consistancy between npc_items_custom.txt and our lua file is complete we can use self.BaseClass for things like cooldown or castrange. Lets replace our mana cost and cooldown functions to see how it works.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetManaCost()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return self.BaseClass.GetManaCost( self, nLevel )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCooldown( nLevel )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return self.BaseClass.GetCooldown( self, nLevel )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now all we need to do is make localization for the item. In your &#x27;dota 2 beta\game\dota_addons{addon name}\resource&#x27; folder you should have addon_english.txt<br>If you are using some different language you might use differently named file. But all languages defaults to english if others fail.<br>
Open it up and lets add following lines to the mix.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff&quot;                                           &quot;Blink Staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_Description&quot;                               &quot;Teleport to a target point up to 1200 units away. Can be used on allied units to select them to blink instead of you.&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_max_blink&quot;                                 &quot;Max Blink Distance:&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_help_range&quot;                                &quot;Help Range:&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_item_blink_staff_effect_modifier&quot;                                             &quot;Blink Staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_item_blink_staff_effect_modifier_Description&quot;                                 &quot;Targeted by Blink Staff&quot;</span></div></div></div></div></div><p>Lets see what we have now:</p><p style="position:relative;padding-bottom:75%"><iframe src="https://gfycat.com/ifr/FrankBleakChihuahua" scrolling="no" frameborder="0" allowfullscreen="" width="100%" height="100%" style="position:absolute;top:0;left:0"></iframe></p><p>Now there are still some things we need to do but first lets fix the most obvious problem. Currently there is a bug where the:<br>
&quot;AbilityUnitTargetTeam&quot;			&quot;DOTA_UNIT_TARGET_TEAM_FRIENDLY&quot;<br>
Is ignored!<br>
We can fix it by adding team check to our cast filters:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:CastFilterResultTarget( hTarget ) -- hTarget is the targeted NPC.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) --How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hCaster:GetTeamNumber() ~= hTarget:GetTeamNumber() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_SUCCESS</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCustomCastErrorTarget( hTarget) -- hTarget is the targeted NPC. </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) --How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hCaster:GetTeamNumber() ~= hTarget:GetTeamNumber() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return &quot;#dota_hud_error_cant_cast_on_enemy&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return &quot;#dota_hud_error_target_has_disable_help&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return &quot;#dota_hud_error_target_out_of_range&quot; --returning error from localization</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Problem with this method is that its easier for user to blink towards the enemy rather than even try &#x27;helping&#x27; him/her. But in this tutorial we assume you can figure it out your how to edit the code to blink when caster and target have different teams using the cast filter changes as example.<br>
Now the thing that makes blink dagger less as efficient as escape tool is it&#x27;s Cooldown when hurt. Lets add that in! To do that we create Intrinsic modifier. Lets link our new modifier:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">LinkLuaModifier( &quot;item_blink_staff_passive_modifier&quot;, &quot;lua_items/blink_staff/passive_modifier.lua&quot;, LUA_MODIFIER_MOTION_NONE )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetIntrinsicModifierName()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return &quot;item_blink_staff_passive_modifier&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now create our declared lua file for it and its contents should be something like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if item_blink_staff_passive_modifier == nil then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    item_blink_staff_passive_modifier = class({})</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:IsHidden()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return true --we want item&#x27;s passive abilities to be hidden most of the times</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:DeclareFunctions() --we want to use these functions in this item</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local funcs = {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MODIFIER_EVENT_ON_TAKEDAMAGE</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return funcs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:OnTakeDamage( params ) --When ever the unit takes damage this is called</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if IsServer() then --this should be only run on server.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local hAbility = self:GetAbility() --we get the ability where this modifier is from</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if params.attacker ~= self:GetParent() and params.unit == self:GetParent() and  params.attacker:IsHero()  then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        hAbility:StartCooldown(hAbility:GetSpecialValueFor( &quot;hurt_cooldown&quot; )) --we start the cooldown</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>As you can see used declare functions to tell the game what to expect from this modifier. This makes sure the game doesn&#x27;t check this modifier with every event that might be effected.<br>
We also added new special value for cooldown when caster gets hurt. Remember to add that to your &#x27;npc_items_custom.txt&#x27; as float value preferably.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;05&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_FLOAT&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;hurt_cooldown&quot;         &quot;3.0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div></div></div></div></div><p>Now we should have covered all the main issues. Next we add recipe for the item and add stats from the components.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="recipe-and-stats"></a>Recipe and Stats<a aria-hidden="true" tabindex="-1" class="hash-link" href="#recipe-and-stats" title="Direct link to heading">#</a></h3><p>As you might have noticed testing our item, it right now costs no gold to purchase. There are two things we can do here. We can either add ItemCost into our &#x27;npc_items_custom.txt&#x27; file or create a recipe for the item. When you create a recipe for your item the game automatically calculates the item cost. We can also add ItemCost to our new recipe to let the game know that you have to buy it aswell instead of items being automatically combined into one. We are also adding the stats from our component items so be sure to add special values to your item reflecting the component stats.</p><p>I will be using item_quarterstaff, item_robe and item_blink for my components. I also make the recipe cost 325 gold. One important thing to note when creating recipe is the naming scheme. The recipe name should always be
&#x27;item_recipe_your_item&#x27;<br>
my item: item_blink_staff<br>
my recipe: item_recipe_blink_staff<br>
Also you must give each item in npc_items_custom.txt unique ID. If you don&#x27;t you may find odd bugs like item not being purchasable. Here is my current entries in npc_items_custom.txt</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1250&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ScriptFile&quot;                    &quot;lua_items/blink_staff/blink_staff.lua&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityTextureName&quot;            &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityUnitTargetTeam&quot;         &quot;DOTA_UNIT_TARGET_TEAM_FRIENDLY&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityUnitTargetType&quot;         &quot;DOTA_UNIT_TARGET_HERO | DOTA_UNIT_TARGET_BASIC&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityCastRange&quot;              &quot;0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityCastPoint&quot;              &quot;0.3&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityCooldown&quot;               &quot;10.0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilityManaCost&quot;               &quot;50&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //// Item Info</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ////-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemCost&quot;                      &quot;3900&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemShopTags&quot;                  &quot;blink;staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemQuality&quot;                   &quot;rare&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemAliases&quot;                   &quot;blink;staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;AbilitySpecial&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;01&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;max_blink&quot;             &quot;1200&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;02&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;blink_clamp&quot;           &quot;960&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;03&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;help_range&quot;            &quot;3000&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;04&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_FLOAT&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;help_duration&quot;         &quot;5.0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;05&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_FLOAT&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;hurt_cooldown&quot;         &quot;3.0&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            // Stats from the recipe items</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;06&quot; // Quarterstaff</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;bonus_damage&quot;          &quot;10&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;07&quot; // Quarterstaff</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;bonus_attack_speed&quot;            &quot;10&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;08&quot; // Robe Of Magi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;bonus_int&quot;         &quot;6&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_recipe_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // General</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_datadriven&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1251&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Item Info</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemCost&quot;                      &quot;325&quot;   </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemShopTags&quot;                  &quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Recipe</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemRecipe&quot;                    &quot;1&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemResult&quot;                    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemRequirements&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;01&quot;                        &quot;item_quarterstaff;item_robe;item_blink&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div></div></div></div></div><p>Notice that the item requirements part lists the items you need. For valve defined ones use this as reference: <br> <a href="https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/Built-In_Item_Names" target="_blank" rel="noopener noreferrer">https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Scripting/Built-In_Item_Names</a> <br>
Also notice how the first entry is defined &quot;01&quot; . This is because you can create recipe that can be used with different sets of components. This is used by valve in Power Threads where you can use any of the basic 450 costing attribute items.<br>
Now while we have defined special values for our blink staff stats, we have not actually used those values anywhere. Lets get back to our blink staff passive modifier lua file we used for the cooldown when taking damage.<br>
Here we have to declare new functions for the stats we need.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:DeclareFunctions() --we want to use these functions in this item</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local funcs = {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MODIFIER_EVENT_ON_TAKEDAMAGE,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MODIFIER_PROPERTY_PREATTACK_BONUS_DAMAGE,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MODIFIER_PROPERTY_ATTACKSPEED_BONUS_CONSTANT,</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        MODIFIER_PROPERTY_STATS_INTELLECT_BONUS</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return funcs</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now that we have declared what we want to effect in game with this modifier lets add functions the game can call on the correct events.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:GetModifierBonusStats_Intellect()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hAbility = self:GetAbility() --we get the ability where this modifier is from</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return hAbility:GetSpecialValueFor( &quot;bonus_int&quot; )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:GetModifierAttackSpeedBonus_Constant()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hAbility = self:GetAbility() --we get the ability where this modifier is from</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return hAbility:GetSpecialValueFor( &quot;bonus_attack_speed&quot; )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff_passive_modifier:GetModifierPreAttack_BonusDamage()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hAbility = self:GetAbility() --we get the ability where this modifier is from</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return hAbility:GetSpecialValueFor( &quot;bonus_damage&quot; )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now last thing we need to do is tell player about the awe-inspiring stats this item gives them. Lets add our new stats to the addon_english.txt<br>
After that our file should have something like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff&quot;                                           &quot;Blink Staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_Description&quot;                               &quot;Teleport to a target point up to 1200 units away. Can be used on allied units to select them to blink instead of you.&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_max_blink&quot;                                 &quot;Max Blink Distance:&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_help_range&quot;                                &quot;Help Range:&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_bonus_damage&quot;                              &quot;+$damage&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_bonus_attack_speed&quot;                        &quot;+$attack&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_bonus_int&quot;                                 &quot;+$int&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_item_blink_staff_effect_modifier&quot;                                             &quot;Blink Staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_item_blink_staff_effect_modifier_Description&quot;                                 &quot;Targeted by Blink Staff&quot;</span></div></div></div></div></div><p>Now we are pretty much done. But because the biggest advantage of lua items is that we can define so many things dynamically so rest of this tutorial we will do few experiments that might not seem very balanced or sensible from game play perspective but just because we can!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="advanced-uses"></a>Advanced Uses<a aria-hidden="true" tabindex="-1" class="hash-link" href="#advanced-uses" title="Direct link to heading">#</a></h3><p>First Lets try effecting the help casting range if we are dealing with large mana pool hero. Since we are using cast filters for the help range limitation we can do this part there. To do this we use our already defined hCaster handle and use function :GetMaxMana() to return the hero&#x27;s mana pool. Then we add that value to our already existing help range. This means that if our caster has 5000 mana pool to use late game he or she will have massive support range of 8000 units.<br>
So lets change the CastFilterResult target and error functions with following:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">    local nRangeBonus = hCaster:GetMaxMana() --Get our caster&#x27;s mana pool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) + nRangeBonus--How far can we actually target?</span></div></div></div></div></div><p>The end result should look something like this</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:CastFilterResultTarget( hTarget ) -- hTarget is the targeted NPC.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nRangeBonus = hCaster:GetMaxMana() --Get our caster&#x27;s mana pool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) + nRangeBonus--How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hCaster:GetTeamNumber() ~= hTarget:GetTeamNumber() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return UF_SUCCESS</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCustomCastErrorTarget( hTarget) -- hTarget is the targeted NPC. </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nRangeBonus = hCaster:GetMaxMana() --Get our caster&#x27;s mana pool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) + nRangeBonus--How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if hCaster:GetTeamNumber() ~= hTarget:GetTeamNumber() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return &quot;#dota_hud_error_cant_cast_on_enemy&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return &quot;#dota_hud_error_target_has_disable_help&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return &quot;#dota_hud_error_target_out_of_range&quot; --returning error from localization</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now you may have noticed how we are using almost same code for both cast filter and the error function. Here is a way to reduce the redundancy:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:CastFilterResultTarget( hTarget ) -- hTarget is the targeted NPC.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return self:CCastFilter( hTarget, false )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:GetCustomCastErrorTarget( hTarget) -- hTarget is the targeted NPC. </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return self:CCastFilter( hTarget, true )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">function item_blink_staff:CCastFilter( hTarget, bError )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if IsServer() then --this should be only run on server.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local hCaster = self:GetCaster() --We will always have Caster.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local vOrigin = hCaster:GetAbsOrigin() --Our caster&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local vPoint = hTarget:GetAbsOrigin() --Our target&#x27;s location</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local nRangeBonus = hCaster:GetMaxMana() --Get our caster&#x27;s mana pool</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local nMaxRange = self:GetSpecialValueFor( &quot;help_range&quot; ) + nRangeBonus--How far can we actually target?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local vDiff = vPoint - vOrigin --Difference between the points</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local nTargetID = hTarget:GetPlayerOwnerID() --getting targets owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        local nCasterID = hCaster:GetPlayerOwnerID() --getting casters owner id</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if hCaster:GetTeamNumber() ~= hTarget:GetTeamNumber() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if bError then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return &quot;#dota_hud_error_cant_cast_on_enemy&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if nTargetID and nCasterID then --making sure they both exist</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if PlayerResource:IsDisableHelpSetForPlayerID(nTargetID, nCasterID) then --target hates having caster help him out.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if bError then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    return &quot;#dota_hud_error_target_has_disable_help&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if vDiff:Length2D() &gt; nMaxRange then  --Check caster is over reaching.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if bError then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return &quot;#dota_hud_error_target_out_of_range&quot; --returning error from localization</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return UF_FAIL_CUSTOM</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if not bError then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            return UF_SUCCESS</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    end</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="item-levels"></a>Item Levels<a aria-hidden="true" tabindex="-1" class="hash-link" href="#item-levels" title="Direct link to heading">#</a></h3><p>As I mentioned early in the tutorial things like bkb and dagon has item levels used. Dagon uses separate items to define the levels while bkb has built-in leveling when ever it is used. We are going to code where we reduce our blink staff help range when ever it is used to help a player.<br>First we need  to add new values for our help ranges between the levels. These are simply separated by spaces between values.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;03&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;help_range&quot;            &quot;3000 2500 2000 1500 1000&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div></div></div></div></div><p>Because there is some odd bugs here and there, the MaxLevel value that we would use for normal abilities doesn&#x27;t work for items. To help us define it in the script we create new special value for it.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;09&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;var_type&quot;              &quot;FIELD_INTEGER&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                &quot;max_level&quot;             &quot;5&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div></div></div></div></div><p>Back to the lua script, we need to upgrade the item only when ally is teleported and not when we simply tag our ally for teleport. First find this line:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">self:Blink(hTarget, vPoint, nMaxBlink, nClamp) --BLINK!</span></div></div></div></div></div><p>Under it lets add the upgrade part. Note that we have to check we don&#x27;t upgrade the item when it&#x27;s fully upgraded.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if self:GetLevel() &lt; self:GetSpecialValueFor( &quot;max_level&quot; ) then --We can&#x27;t define max level for item like we can with abilities. Best to create special value for it.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    self:UpgradeAbility(true)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>We could also add condition where if the game is currently in night time the upgrade doesn&#x27;t happen. Letting our hero help his allies for free!</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if self:GetLevel() &lt; self:GetSpecialValueFor( &quot;max_level&quot; ) and GameRules:IsDaytime() then</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    self:UpgradeAbility(true)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">end</span></div></div></div></div></div><p>Now if we want to let our hero refresh the help range levels then we can either script some event where we reset the item&#x27;s level with:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-lua codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">self:SetLevel(1)</span></div></div></div></div></div><p>Or we can use more elegant choice of modifying our recipe to act like charge refresh for drums of endurance.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    &quot;item_recipe_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // General</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;BaseClass&quot;                     &quot;item_datadriven&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ID&quot;                            &quot;1251&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Item Info</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemCost&quot;                      &quot;325&quot;   </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemShopTags&quot;                  &quot;&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        // Recipe</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        //-------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemRecipe&quot;                    &quot;1&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemResult&quot;                    &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;ItemRequirements&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;01&quot;                        &quot;item_quarterstaff;item_robe;item_blink&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;02&quot;                        &quot;item_blink_staff&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div></div></div></div></div><p>Notice how we added &quot;02&quot; to the item requirements and it only requires the item &quot;item_blink_staff&quot;. This means we can combine our original blink staff to create fully new one with level set to its default value.<br>Now what you should remember to do is change the description of the item and not keep the player guessing.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">        &quot;DOTA_Tooltip_ability_item_blink_staff_Description&quot;                               &quot;Teleport to a target point up to 1200 units away. Can be used on allied units to select them to blink instead of you. If you take damage the Blink Staff is put on 3.0 second cooldown. Every time you help ally the help range is reduced by 500. This doesn&#x27;t apply if used durring night time. You maximum mana is added to the help distance.&quot;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-end"></a>The End<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-end" title="Direct link to heading">#</a></h3><p>That is end of this tutorial. If you have requests concerning this tutorial or improvements/corrections please comment bellow.<br>
You can find this and other lua items and abilities from my Dota2Overflow github repo.<br>
<a href="https://github.com/DrTeaSpoon/Dota2Overflow" target="_blank" rel="noopener noreferrer">https://github.com/DrTeaSpoon/Dota2Overflow</a></p><br>To help declaring modifier functions use this for resource:<br>https://developer.valvesoftware.com/wiki/Dota_2_Workshop_Tools/Lua_Abilities_and_Modifiers#Modifier_Functions<br>Big thanks to BMD for barebones. While this tutorial has nothing to do with his repo, I used it for testing ground and creating the visual aids.<br>Big thanks to all who have contributed to https://github.com/Pizzalol/SpellLibrary<br><p>Happy Blinking!</p><p style="position:relative;padding-bottom:75%"><iframe src="https://gfycat.com/ifr/AthleticEminentAnnashummingbird" scrolling="no" frameborder="0" allowfullscreen="" width="100%" height="100%" style="position:absolute;top:0;left:0"></iframe></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/abilities/calling-spells-with-setcursor"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label"> Calling Spells with SetCursor</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/abilities/lua-modifiers/1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Extending Hero/NPC API with lua modifiers </div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_tVyB"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#blink-staff" class="table-of-contents__link">Blink Staff</a></li><li><a href="#defining-cast-rules" class="table-of-contents__link">Defining Cast Rules</a></li><li><a href="#cast-on-allied" class="table-of-contents__link">Cast on Allied</a></li><li><a href="#recipe-and-stats" class="table-of-contents__link">Recipe and Stats</a></li><li><a href="#advanced-uses" class="table-of-contents__link">Advanced Uses</a></li><li><a href="#item-levels" class="table-of-contents__link">Item Levels</a></li><li><a href="#the-end" class="table-of-contents__link">The End</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/styles.3ddff82c.js"></script>
<script src="/runtime~main.664ba720.js"></script>
<script src="/main.cd2666c9.js"></script>
<script src="/1.121d2a65.js"></script>
<script src="/2.37db2c14.js"></script>
<script src="/1be78505.25cc5caf.js"></script>
<script src="/ec1ed54d.b1d23cdd.js"></script>
<script src="/59ffb1e8.dacc4226.js"></script>
</body>
</html>